<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.app.mapper.CommonMapper">
    <!-- platformIDによるplatform情報の照会 -->
    <select id="FindMasterPlatforms" resultType="com.web.app.domain.Entity.MasterPlatforms">
        SELECT
            Id,
            PlatformName,
            Logo,
            Logo_small,
            TimeZone,
            Currency,
            CurrencyMark,
            HeatUpWeight,
            RemindTiming_reply,
            RemindTiming_claimreply,
            RemindTiming_negotiation,
            RemindTiming_ex_neg,
            RemindTiming_mediation,
            RemindTiming_ex_med,
            InfoFrequency,
            WorkDayBase,
            PetitionNoticeMode,
            PetitionNoticeEmail,
            ReplyLimitDays,
            CounterclaimLimitDays,
            NegotiationLimitDays,
            NegotiationExtendDays,
            MediationLimitDays,
            MediationExtentdDays,
            UserProductId,
            UseTraderName,
            UseProductUrl,
            UseOther,
            UseRepliesOther,
            UseClaimRepliesOther,
            UseNegotiationsOther,
            UseMediationsOther,
            UseDefaultTraderEmail,
            DefaultTraderEmail,
            MessageUpdateFrequency,
            languageId,
            ShowMiddleName,
            MediatorAssignType,
            MediatorPrivateMessage,
            MediatorPrivateMessageAddMode,
            MediatorInfoLimit,
            MediatorInfoLimitConfirmDays,
            Phase_negotiation,
            Phase_mediation,
            Phase_arbitration,
            Phase_reply,
            ServiceSiteUrl,
            PetitionsContexFile,
            RepliesContextFile,
            ClaimRepliesContextFileR,
            ClaimRepliesContextFileC,
            NegotiationsContextFile,
            MediationsContextFile,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy,
            moduleLastModifiedBy,
            moduleLastModifiedDate,
            functionlastModifiedBy,
            functionlastModifiedDate,
            limitLastModifiedBy,
            limitLastModifiedDate,
            notificationLastModifiedBy,
            notificationLastModifiedDate,
            platformLastModifiedBy,
            platformLastModifiedDate,
            pfOptionPetitionsLastModifiedBy,
            pfOptionPetitionsLastModifiedDate,
            pfOptionRepliesLastModifiedBy,
            pfOptionRepliesLastModifiedDate,
            pfOptionClaimRepliesLastModifiedBy,
            pfOptionClaimRepliesLastModifiedDate,
            pfOptionNegotiationsLastModifiedBy,
            pfOptionNegotiationsLastModifiedDate,
            pfOptionMediationsLastModifiedBy,
            pfOptionMediationsLastModifiedDate
        FROM
            master_platforms
        WHERE
            Id = #{platformId}
            AND DeleteFlag = false
        ORDER BY
            Id
    </select>

    <!-- ユーザーIDまたはユーザーメールボックスに基づいたユーザー情報の照会 -->
    <select id="FindUserByUidOrEmail" resultType="com.web.app.domain.Entity.OdrUsers">
        SELECT
            Uid,
            PlatformId,
            password,
            Email,
            FirstName,
            MiddleName,
            LastName,
            FirstName_EN,
            LastName_EN,
            FirstName_kana,
            MiddleName_kana,
            LastName_kana,
            LanguageId,
            Status,
            TimeZone,
            ThemeId,
            TermsConfirmStatus,
            ConfirmedVersionNoOfTerms,
            ConfirmedVersionNoOfPolicy,
            MessageFrequency,
            TermsConfirmed,
            ResumeFileId,
            SelfIntroduce,
            HistoryInfo,
            Major,
            Position,
            ProfilePictureFileId,
            UserType,
            CompanyName,
            CompanyName_en,
            ShowTuritor1,
            ShowTuritor2,
            ShowTuritor3,
            LastLoginDate,
            RegisterDate,
            AccessFailedCount,
            LockoutEnd,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        FROM
            odr_users
        WHERE
            <choose>
                <when test="uid != null and uid != ''">
                    Uid = #{uid}
                </when>
                <otherwise>
                    Email = #{email}
                </otherwise>
            </choose>
            <choose>
                <when test="platformId != null and platformId != ''">
                    AND PlatformId = #{platformId}
                </when>
                <otherwise>
                    AND 1 = 1
                </otherwise>
            </choose>
            AND DeleteFlag = false
    </select>
    <!-- caseIDによる案件情報の照会 -->
    <select id="FindCasesInfoByCid" resultType="com.web.app.domain.Entity.Cases">
        SELECT
            cid,
            PlatformId,
            CaseStage,
            CaseStatus,
            CaseTitle,
            PetitionDate,
            WithDrawDate,
            ReplyStartDate,
            ReplyEndDate,
            CounterclaimFlag,
            CounterclaimStartDate,
            CounterclaimEndDate,
            NegotiationStartDate,
            NegotiationEndDate,
            NegotiationEndDateChangeStatus,
            NegotiationEndDateChangeCount,
            CancelDate,
            MediatorReuqestDate,
            MediationStartDate,
            MediationEndDate,
            MediationEndDateChangeCount,
            MediatorNoReasonChangeDate,
            MediatorDisclosureDate,
            MediatorChangeableCount1,
            MediatorChangeableCount2,
            MediatorDisclosureFlag,
            GroupMessageFlag1,
            GroupMessageFlag2,
            GroupMessageComment1,
            GroupMessageComment2,
            ArbitrationStartDate,
            ArbitrationEndDate,
            ArbitrationEditDate,
            ResolutionDate,
            ResolutionFlag,
            PayFlag,
            CounterclaimPayFlag,
            LanguageId,
            QuestionnaireSendFlag,
            CancelBy,
            CancelActionDate,
            CancelReuqestBy1,
            CancelReuqestBy2,
            CancelReuqestBy3,
            OtherDate01,
            OtherDate02,
            OtherDate03,
            OtherDate04,
            OtherDate05,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        FROM
            cases
        WHERE
            cid = #{cid}
            AND DeleteFlag = false
    </select>

    <!-- チェックボックスを取得する方法 -->
    <select id="FindMasterTypeName" resultType="com.web.app.domain.Entity.MasterTypes">
        SELECT
            Id,
            platformId,
            type,
            Value,
            DisplayName,
            OrderNo,
            Required,
            IsActive,
            LanguageId,
            Creator,
            CreateDate,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        FROM
            master_types
        WHERE
            platformId = #{platformId}
            AND type = #{type}
            AND IsActive = 1
            AND LanguageId = #{languageId}
            AND DeleteFlag = false
        ORDER BY
            OrderNo
    </select>

    <!-- メールテンプレートの取得 -->
    <select id="FindMailTemplatesList" resultType="com.web.app.domain.Entity.MailTemplates">
        SELECT
            Id,
            PlatformId,
            TemplateNo,
            SendFromMail,
            SendFromName,
            Subject,
            HtmlContent,
            TextContent,
            LanguageId,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        FROM
            mail_templates
        WHERE
            PlatformId = #{platformId}
            AND TemplateNo = #{tempId}
            AND LanguageId = 'jp'
    </select>
</mapper>