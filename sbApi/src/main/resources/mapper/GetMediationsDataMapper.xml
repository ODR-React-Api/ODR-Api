<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.app.mapper.GetMediationsDataMapper">
    <select id="selectMediationsData" resultType="com.web.app.domain.MediationsMake.Mediation">
        SELECT
            cm.ExpectResloveTypeValue,
            cm.Status,
            cm.OtherContext,
            cm.PayAmount,
            cm.CounterClaimPayment,
            cm.PaymentEndDate,
            cm.ShipmentPayType,
            cm.AgreementDate,
            cm.SpecialItem,
            cm.UserId,
            fi.FileName,
            fi.FileUrl
        FROM
            case_mediations as cm
        LEFT JOIN
            files as fi
        ON
            cm.CaseId = fi.CaseId
        AND 
            cm.PlatformId = fi.PlatformId

        LEFT JOIN
            case_file_relations as cfr
        ON
            cm.CaseId = cfr.CaseId
        AND 
            cm.PlatformId = cfr.PlatformId

        WHERE
            cm.CaseId = #{caseId} AND
            cm.platformId = #{platformId} AND
            cm.DeleteFlag = 0 AND
            cm.CaseId = cfr.CaseId AND
            cfr.platformId = #{platformId} AND
            cfr.RelationType = 5 AND
            cfr.RelatedId = cm.id AND
            cfr.DeleteFlag = 0 AND
            fi.id = cfr.fileId AND
            fi.platformId = #{platformId}
        ORDER BY
            fi.LastModifiedDate
    </select>
</mapper>