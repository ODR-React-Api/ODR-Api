<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.app.mapper.UpdRepliesDataMapper">
    <!-- API_反訴・回答データ新規登録/更新 -->
    <!-- 「反訴・回答」取得 -->
    <select id="getCaseRepliesCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM case_replies
        WHERE
            CaseId = #{caseId}
        AND PlatformId = #{platformId}
    </select>
    <!-- 「反訴・回答」新規登録 -->
    <insert id="insCaseReplies" parameterType="com.web.app.domain.Entity.CaseReplies">
        INSERT INTO case_replies(
            id,
            PlatformId,
            CaseId,
            Status,
            replyType,
            replyTypeOther,
            replyContext,
            HaveCounterClaim,
            CounterClaimContext,
            TraderAgent1_UserEmail,
            TraderAgent2_UserEmail,
            TraderAgent3_UserEmail,
            TraderAgent4_UserEmail,
            TraderAgent5_UserEmail,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        )VALUES(
            #{id},
            #{PlatformId},
            #{CaseId},
            #{Status},
            #{replyType},
            #{replyTypeOther},
            #{replyContext},
            #{HaveCounterClaim},
            #{CounterClaimContext},
            #{TraderAgent1_UserEmail},
            #{TraderAgent2_UserEmail},
            #{TraderAgent3_UserEmail},
            #{TraderAgent4_UserEmail},
            #{TraderAgent5_UserEmail},
            #{Other01},
            #{Other02},
            #{Other03},
            #{Other04},
            #{Other05},
            #{DeleteFlag},
            CURRENT_TIMESTAMP(),
            #{LastModifiedBy}
        )
    </insert>
    <!-- 「反訴・回答.id」取得 -->
    <select id="getCaseRepliesId" resultType="java.lang.String">
        SELECT id
        FROM case_replies
        WHERE
            CaseId = #{caseId}
        AND PlatformId = #{platformId}
    </select>
    <!-- 「反訴・回答」更新 -->
    <update id="updCaseReplies" parameterType="com.web.app.domain.Entity.CaseReplies">
        UPDATE case_replies
        SET replyType = #{replyType},
            replyTypeOther = #{replyTypeOther},
            replyContext = #{replyContext},
            HaveCounterClaim = #{HaveCounterClaim},
            CounterClaimContext = #{CounterClaimContext},
            TraderAgent1_UserEmail = #{TraderAgent1_UserEmail},
            TraderAgent2_UserEmail = #{TraderAgent2_UserEmail},
            TraderAgent3_UserEmail = #{TraderAgent3_UserEmail},
            TraderAgent4_UserEmail = #{TraderAgent4_UserEmail},
            TraderAgent5_UserEmail = #{TraderAgent5_UserEmail},
            LastModifiedDate = CURRENT_TIMESTAMP(),
            LastModifiedBy = #{LastModifiedBy}
        WHERE
            CaseId = #{caseId}
        AND PlatformId = #{platformId}
    </update>

    <!-- 「添付ファイル」論理削除 -->
    <update id="updFiles" parameterType="com.web.app.domain.AnswerLogin.UpdRepliesDataParameter">
        UPDATE files
        SET DeleteFlag = 1,
            LastModifiedDate = CURRENT_TIMESTAMP(),
            LastModifiedBy = #{loginUser}
        WHERE
            id = #{delFileId}
        AND PlatformId = #{platformId}
    </update>
    <!-- 「添付ファイル」取得 -->
    <select id="getFilesCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM files
        WHERE
            CaseId = #{caseId}
        AND PlatformId = #{platformId}
        AND FileName = #{fileName}
        AND FileExtension = #{fileExtension}
    </select>
    <!-- 「添付ファイル」の新規登録 -->
    <insert id="insFiles" parameterType="com.web.app.domain.Entity.Files">
        INSERT INTO files(
            id,
            PlatformId,
            CaseId,
            FileName,
            FileExtension,
            FileUrl,
            FileBlobStorageId,
            FileSize,
            RegisterUserId,
            RegisterDate,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        )VALUES(
            #{id},
            #{PlatformId},
            #{CaseId},
            #{FileName},
            #{FileExtension},
            #{FileUrl},
            #{FileBlobStorageId},
            #{FileSize},
            #{RegisterUserId},
            CURRENT_TIMESTAMP(),
            #{Other01},
            #{Other02},
            #{Other03},
            #{Other04},
            #{Other05},
            #{DeleteFlag},
            CURRENT_TIMESTAMP(),
            #{LastModifiedBy}
        )
    </insert>

    <!-- 「案件-添付ファイルリレーション」論理削除 -->
    <update id="updCaseFileRelations" parameterType="com.web.app.domain.AnswerLogin.UpdRepliesDataParameter">
        UPDATE case_file_relations
        SET DeleteFlag = 1,
            LastModifiedDate = CURRENT_TIMESTAMP(),
            LastModifiedBy = #{loginUser}
        WHERE
            fileId = #{delFileId}
        AND PlatformId = #{platformId}
    </update>
    <!-- 「案件-添付ファイルリレーション」新規登録 -->
    <insert id="insCaseFileRelations" parameterType="com.web.app.domain.Entity.CaseFileRelations">
        INSERT INTO case_file_relations(
            id,
            PlatformId,
            CaseId,
            RelationType,
            RelatedId,
            fileId,
            Other01,
            Other02,
            Other03,
            Other04,
            Other05,
            DeleteFlag,
            LastModifiedDate,
            LastModifiedBy
        )VALUES(
            #{id},
            #{PlatformId},
            #{CaseId},
            #{RelationType},
            #{RelatedId},
            #{fileId},
            #{Other01},
            #{Other02},
            #{Other03},
            #{Other04},
            #{Other05},
            #{DeleteFlag},
            CURRENT_TIMESTAMP(),
            #{LastModifiedBy}
        )
    </insert>
</mapper>