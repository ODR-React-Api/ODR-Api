<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.app.mapper.GetCaseClaimrepliesMosDetailMapper">
    <!--  API_反訴への回答取得 -->

    <!-- 下書き保存データを取得 個数-->
    <resultMap id="BaseResultMap" type="com.web.app.domain.MosDetail.CaseClaimrepliesMosDetail">
    </resultMap>
    <select id="selectCaseClaimreplies" resultType="int">
        SELECT COUNT(*) 
        FROM react_use.case_claimreplies
        WHERE CaseId = #{caseId}
        AND Status = 0
        AND DeleteFlag = 0
    </select>

    <!--  反訴への回答内容の取得 -->
    <resultMap id="caseClaimrepliesMosDetailContent" type="com.web.app.domain.MosDetail.CaseClaimrepliesMosDetail">
    </resultMap>
    <select id="getCaseClaimrepliesMosDetailContent" resultMap="caseClaimrepliesMosDetailContent">
        SELECT  CaseId,
                Status,
                ReplyContext,
                LastModifiedDate 
        FROM react_use.case_claimreplies 
        WHERE CaseId = #{caseId}
        AND   Status != 0
        AND   DeleteFlag = 0
    </select>

    <!-- 添付資料の取得 -->
    <resultMap id="filesMap" type="com.web.app.domain.Entity.Files">
    </resultMap>
    <select id="getFiles" resultMap="filesMap">
        SELECT
            files.FileName,
            files.FileUrl
        FROM case_file_relations, files
        WHERE
            case_file_relations.CaseId = #{caseId}
        AND case_file_relations.RelationType = 3
        AND case_file_relations.DeleteFlag = 0
        AND files.id = case_file_relations.fileId
        AND files.DeleteFlag = 0
        ORDER BY files.LastModifiedDate
    </select>

</mapper>
